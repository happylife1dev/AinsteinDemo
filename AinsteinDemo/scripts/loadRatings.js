
var d = { "TickerSymbol": "ibm", "RatingsProfileScore": 2.72727272727272727272727272727272727273, "ScoreConfidence": 143, "ScoreDescription": "", "TotalScoreDebug": 390, "TotalWeightDebug": 143, "RatingsGroups": { "Sentiment": { "OverallGroupRating": 1.5, "Components": [{ "Name": "News", "Score": 1, "ExtraInfo": "", "Weight": 1 }, { "Name": "Tone", "Score": 2, "ExtraInfo": "", "Weight": 1 }] }, "Cyber": { "OverallGroupRating": 2.5, "Components": [{ "Name": "Cyber1", "Score": 2, "ExtraInfo": "", "Weight": 1 }, { "Name": "Cyber2", "Score": 3, "ExtraInfo": "", "Weight": 1 }] }, "Options": { "OverallGroupRating": 3.5, "Components": [{ "Name": "Options1", "Score": 3, "ExtraInfo": "", "Weight": 1 }, { "Name": "Options2", "Score": 4, "ExtraInfo": "", "Weight": 1 }] }, "Timing 1": { "OverallGroupRating": 3, "Components": [{ "Name": "RSI", "Score": 1, "ExtraInfo": "Score of 2.2", "Weight": 1 }, { "Name": "STO14", "Score": 3, "ExtraInfo": "Score of 52.3", "Weight": 1 }, { "Name": "MACD (Long Term)", "Score": 1, "ExtraInfo": "Score of 1.1", "Weight": 1 }] }, "Valuation 1": { "OverallGroupRating": 3, "Components": [{ "Name": "PE", "Score": 5, "ExtraInfo": "Trades at a <font color=\"Green\">discount</font> PE of 11X vs 18.8X for the Computers SubIndustry ", "Weight": 1 }, { "Name": "PEG", "Score": 2, "ExtraInfo": "Trades at a <font color=\"Green\">discount</font> PEG of 1X vs 2.7X for the Computers SubIndustry ", "Weight": 1 }] }, "Growth 1": { "OverallGroupRating": 3, "Components": [{ "Name": "GROWTH", "Score": 5, "ExtraInfo": ".05 vs Computers of ", "Weight": 1 }, { "Name": "Earnings Revenue Growth", "Score": 0, "ExtraInfo": "", "Weight": 1 }, { "Name": "Earnings Margin", "Score": 4, "ExtraInfo": "Ranks 6 of 12 with value of 0", "Weight": 1 }, { "Name": "Earnings Margin Growth", "Score": 0, "ExtraInfo": "", "Weight": 1 }, { "Name": "EPS Growth", "Score": 0, "ExtraInfo": "", "Weight": 1 }, { "Name": "Momentum 2016", "Score": 5, "ExtraInfo": "Ranks 75 of 91", "Weight": 1 }, { "Name": "Momentum 2015", "Score": 4, "ExtraInfo": "Ranks 194 of 255", "Weight": 1 }, { "Name": "Momentum 2014", "Score": 3, "ExtraInfo": "Ranks 144 of 274", "Weight": 1 }, { "Name": "Momentum 2013", "Score": 3, "ExtraInfo": "Ranks 109 of 270", "Weight": 1 }, { "Name": "Momentum 2012", "Score": 2, "ExtraInfo": "Ranks 78 of 255", "Weight": 1 }, { "Name": "Momentum 2011", "Score": 3, "ExtraInfo": "Ranks 83 of 197", "Weight": 1 }, { "Name": "Momentum 2010", "Score": 3, "ExtraInfo": "Ranks 101 of 186", "Weight": 1 }, { "Name": "Momentum 2009", "Score": 2, "ExtraInfo": "Ranks 65 of 171", "Weight": 1 }, { "Name": "Momentum 2008", "Score": 2, "ExtraInfo": "Ranks 56 of 179", "Weight": 1 }, { "Name": "Momentum 2007", "Score": 3, "ExtraInfo": "Ranks 84 of 176", "Weight": 1 }, { "Name": "Momentum 2006", "Score": 2, "ExtraInfo": "Ranks 56 of 154", "Weight": 1 }, { "Name": "Momentum 2005", "Score": 4, "ExtraInfo": "Ranks 88 of 140", "Weight": 1 }, { "Name": "Momentum 2004", "Score": 3, "ExtraInfo": "Ranks 72 of 133", "Weight": 1 }, { "Name": "Momentum 2003", "Score": 3, "ExtraInfo": "Ranks 53 of 125", "Weight": 1 }, { "Name": "Momentum 2002", "Score": 4, "ExtraInfo": "Ranks 60 of 101", "Weight": 1 }, { "Name": "Momentum 2001", "Score": 3, "ExtraInfo": "Ranks 52 of 126", "Weight": 1 }, { "Name": "Momentum 2000", "Score": 1, "ExtraInfo": "Ranks 20 of 126", "Weight": 1 }, { "Name": "Momentum 1999", "Score": 0, "ExtraInfo": "", "Weight": 1 }, { "Name": "Momentum 2014 Q4", "Score": 2, "ExtraInfo": "Ranks 62 of 243", "Weight": 1 }, { "Name": "Momentum 2014 Q3", "Score": 3, "ExtraInfo": "Ranks 136 of 250", "Weight": 1 }, { "Name": "Momentum 2014 Q2", "Score": 1, "ExtraInfo": "Ranks 41 of 248", "Weight": 1 }, { "Name": "Momentum 2014 Q1", "Score": 4, "ExtraInfo": "Ranks 165 of 246", "Weight": 1 }, { "Name": "Momentum 2013 Q4", "Score": 2, "ExtraInfo": "Ranks 52 of 259", "Weight": 1 }, { "Name": "Momentum 2013 Q3", "Score": 3, "ExtraInfo": "Ranks 113 of 254", "Weight": 1 }, { "Name": "Momentum 2013 Q2", "Score": 2, "ExtraInfo": "Ranks 70 of 251", "Weight": 1 }, { "Name": "Momentum 2013 Q1", "Score": 3, "ExtraInfo": "Ranks 161 of 326", "Weight": 1 }, { "Name": "Momentum 2012 Q4", "Score": 2, "ExtraInfo": "Ranks 71 of 324", "Weight": 1 }, { "Name": "Momentum 2012 Q3", "Score": 2, "ExtraInfo": "Ranks 86 of 327", "Weight": 1 }, { "Name": "Momentum 2012 Q2", "Score": 2, "ExtraInfo": "Ranks 101 of 282", "Weight": 1 }, { "Name": "Momentum 2012 Q1", "Score": 2, "ExtraInfo": "Ranks 118 of 319", "Weight": 1 }, { "Name": "Momentum 2011 Q4", "Score": 2, "ExtraInfo": "Ranks 111 of 299", "Weight": 1 }, { "Name": "Momentum 2011 Q3", "Score": 2, "ExtraInfo": "Ranks 109 of 306", "Weight": 1 }, { "Name": "Momentum 2011 Q2", "Score": 2, "ExtraInfo": "Ranks 113 of 292", "Weight": 1 }, { "Name": "Momentum 2011 Q1", "Score": 3, "ExtraInfo": "Ranks 117 of 283", "Weight": 1 }, { "Name": "Momentum 2010 Q4", "Score": 3, "ExtraInfo": "Ranks 118 of 261", "Weight": 1 }, { "Name": "Momentum 2010 Q3", "Score": 3, "ExtraInfo": "Ranks 126 of 263", "Weight": 1 }, { "Name": "Momentum 2010 Q2", "Score": 3, "ExtraInfo": "Ranks 115 of 257", "Weight": 1 }, { "Name": "Momentum 2010 Q1", "Score": 3, "ExtraInfo": "Ranks 119 of 252", "Weight": 1 }, { "Name": "Momentum 2009 Q4", "Score": 3, "ExtraInfo": "Ranks 106 of 241", "Weight": 1 }, { "Name": "Momentum 2009 Q3", "Score": 1, "ExtraInfo": "Ranks 47 of 242", "Weight": 1 }, { "Name": "Momentum 2009 Q2", "Score": 2, "ExtraInfo": "Ranks 52 of 232", "Weight": 1 }, { "Name": "Momentum 2009 Q1", "Score": 2, "ExtraInfo": "Ranks 68 of 234", "Weight": 1 }, { "Name": "Momentum 2008 Q4", "Score": 2, "ExtraInfo": "Ranks 45 of 227", "Weight": 1 }, { "Name": "Momentum 2008 Q3", "Score": 2, "ExtraInfo": "Ranks 56 of 171", "Weight": 1 }, { "Name": "Momentum 2008 Q2", "Score": 2, "ExtraInfo": "Ranks 49 of 175", "Weight": 1 }, { "Name": "Momentum 2008 Q1", "Score": 2, "ExtraInfo": "Ranks 55 of 175", "Weight": 1 }, { "Name": "Momentum 2007 Q4", "Score": 2, "ExtraInfo": "Ranks 66 of 174", "Weight": 1 }, { "Name": "Momentum 2007 Q3", "Score": 3, "ExtraInfo": "Ranks 85 of 172", "Weight": 1 }, { "Name": "Momentum 2007 Q2", "Score": 3, "ExtraInfo": "Ranks 73 of 174", "Weight": 1 }, { "Name": "Momentum 2007 Q1", "Score": 3, "ExtraInfo": "Ranks 68 of 164", "Weight": 1 }, { "Name": "Momentum 2006 Q4", "Score": 3, "ExtraInfo": "Ranks 70 of 152", "Weight": 1 }, { "Name": "Momentum 2006 Q3", "Score": 2, "ExtraInfo": "Ranks 52 of 148", "Weight": 1 }, { "Name": "Momentum 2006 Q2", "Score": 2, "ExtraInfo": "Ranks 47 of 146", "Weight": 1 }, { "Name": "Momentum 2006 Q1", "Score": 2, "ExtraInfo": "Ranks 45 of 148", "Weight": 1 }, { "Name": "Momentum 2005 Q4", "Score": 3, "ExtraInfo": "Ranks 73 of 145", "Weight": 1 }, { "Name": "Momentum 2005 Q3", "Score": 3, "ExtraInfo": "Ranks 79 of 139", "Weight": 1 }, { "Name": "Momentum 2005 Q2", "Score": 4, "ExtraInfo": "Ranks 86 of 136", "Weight": 1 }, { "Name": "Momentum 2005 Q1", "Score": 4, "ExtraInfo": "Ranks 81 of 132", "Weight": 1 }, { "Name": "Momentum 2004 Q4", "Score": 3, "ExtraInfo": "Ranks 75 of 130", "Weight": 1 }, { "Name": "Momentum 2004 Q3", "Score": 3, "ExtraInfo": "Ranks 69 of 130", "Weight": 1 }, { "Name": "Momentum 2004 Q2", "Score": 3, "ExtraInfo": "Ranks 67 of 126", "Weight": 1 }, { "Name": "Momentum 2004 Q1", "Score": 3, "ExtraInfo": "Ranks 56 of 122", "Weight": 1 }, { "Name": "Momentum 2003 Q4", "Score": 3, "ExtraInfo": "Ranks 63 of 124", "Weight": 1 }, { "Name": "Momentum 2003 Q3", "Score": 3, "ExtraInfo": "Ranks 54 of 119", "Weight": 1 }, { "Name": "Momentum 2003 Q2", "Score": 0, "ExtraInfo": "", "Weight": 1 }, { "Name": "Momentum 2003 Q1", "Score": 0, "ExtraInfo": "", "Weight": 1 }, { "Name": "Momentum 2002 Q4", "Score": 3, "ExtraInfo": "Ranks 57 of 110", "Weight": 1 }, { "Name": "Momentum 2002 Q3", "Score": 3, "ExtraInfo": "Ranks 52 of 100", "Weight": 1 }, { "Name": "Momentum 2002 Q2", "Score": 0, "ExtraInfo": "", "Weight": 1 }, { "Name": "Momentum 2002 Q1", "Score": 0, "ExtraInfo": "", "Weight": 1 }, { "Name": "Momentum 2001 Q4", "Score": 3, "ExtraInfo": "Ranks 48 of 109", "Weight": 1 }, { "Name": "Momentum 2001 Q3", "Score": 2, "ExtraInfo": "Ranks 44 of 118", "Weight": 1 }, { "Name": "Momentum 2001 Q2", "Score": 3, "ExtraInfo": "Ranks 48 of 123", "Weight": 1 }, { "Name": "Momentum 2001 Q1", "Score": 2, "ExtraInfo": "Ranks 43 of 122", "Weight": 1 }, { "Name": "Momentum 2000 Q4", "Score": 2, "ExtraInfo": "Ranks 44 of 124", "Weight": 1 }, { "Name": "Momentum 2000 Q3", "Score": 2, "ExtraInfo": "Ranks 46 of 124", "Weight": 1 }, { "Name": "Momentum 2000 Q2", "Score": 0, "ExtraInfo": "", "Weight": 1 }, { "Name": "Momentum 2000 Q1", "Score": 0, "ExtraInfo": "", "Weight": 1 }, { "Name": "Momentum 1999 Q4", "Score": 0, "ExtraInfo": "", "Weight": 1 }] }, "Earnings 1": { "OverallGroupRating": 1, "Components": [{ "Name": "Earnings 2016", "Score": 1, "ExtraInfo": "Ranks 2 of 91", "Weight": 1 }, { "Name": "Earnings 2015", "Score": 1, "ExtraInfo": "Ranks 1 of 255", "Weight": 1 }, { "Name": "Earnings 2014", "Score": 1, "ExtraInfo": "Ranks 3 of 274", "Weight": 1 }, { "Name": "Earnings 2013", "Score": 1, "ExtraInfo": "Ranks 3 of 270", "Weight": 1 }, { "Name": "Earnings 2012", "Score": 1, "ExtraInfo": "Ranks 3 of 255", "Weight": 1 }, { "Name": "Earnings 2011", "Score": 1, "ExtraInfo": "Ranks 3 of 197", "Weight": 1 }, { "Name": "Earnings 2010", "Score": 1, "ExtraInfo": "Ranks 3 of 186", "Weight": 1 }, { "Name": "Earnings 2009", "Score": 1, "ExtraInfo": "Ranks 2 of 171", "Weight": 1 }, { "Name": "Earnings 2008", "Score": 1, "ExtraInfo": "Ranks 2 of 179", "Weight": 1 }, { "Name": "Earnings 2007", "Score": 1, "ExtraInfo": "Ranks 2 of 176", "Weight": 1 }, { "Name": "Earnings 2006", "Score": 1, "ExtraInfo": "Ranks 2 of 154", "Weight": 1 }, { "Name": "Earnings 2005", "Score": 1, "ExtraInfo": "Ranks 2 of 140", "Weight": 1 }, { "Name": "Earnings 2004", "Score": 1, "ExtraInfo": "Ranks 1 of 133", "Weight": 1 }, { "Name": "Earnings 2003", "Score": 1, "ExtraInfo": "Ranks 2 of 125", "Weight": 1 }, { "Name": "Earnings 2002", "Score": 1, "ExtraInfo": "Ranks 2 of 101", "Weight": 1 }, { "Name": "Earnings 2001", "Score": 1, "ExtraInfo": "Ranks 2 of 126", "Weight": 1 }, { "Name": "Earnings 2000", "Score": 1, "ExtraInfo": "Ranks 2 of 126", "Weight": 1 }, { "Name": "Earnings 1999", "Score": 1, "ExtraInfo": "Ranks 2 of 66", "Weight": 1 }] }, "Cash Flow 1": { "OverallGroupRating": 1.2, "Components": [{ "Name": "Cash Flow 2014", "Score": 3, "ExtraInfo": "Value                 .15 ranks 13 of 30", "Weight": 1 }, { "Name": "Cash Flow 2013", "Score": 3, "ExtraInfo": "Value                 .13 ranks 23 of 59", "Weight": 1 }, { "Name": "Cash Flow 2012", "Score": 2, "ExtraInfo": "Value                 .17 ranks 21 of 63", "Weight": 1 }, { "Name": "Cash Flow 2011", "Score": 2, "ExtraInfo": "Value                 .15 ranks 18 of 52", "Weight": 1 }, { "Name": "Cash Flow 2010", "Score": 3, "ExtraInfo": "Value                 .16 ranks 16 of 33", "Weight": 1 }, { "Name": "Cash Flow 2009", "Score": 4, "ExtraInfo": "Value                 .18 ranks 11 of 19", "Weight": 1 }, { "Name": "Cash Flow 2008", "Score": 0, "ExtraInfo": "", "Weight": 1 }] }, "Revenue 1": { "OverallGroupRating": 2, "Components": [{ "Name": "Revenue 2014", "Score": 2, "ExtraInfo": "Value   22,484,000,000.00 ranks 9 of 30", "Weight": 1 }, { "Name": "Revenue 2013", "Score": 2, "ExtraInfo": "Value   23,408,000,000.00 ranks 17 of 59", "Weight": 1 }, { "Name": "Revenue 2012", "Score": 2, "ExtraInfo": "Value   24,673,000,000.00 ranks 19 of 63", "Weight": 1 }, { "Name": "Revenue 2011", "Score": 2, "ExtraInfo": "Value   24,607,000,000.00 ranks 16 of 52", "Weight": 1 }, { "Name": "Revenue 2010", "Score": 3, "ExtraInfo": "Value   22,857,000,000.00 ranks 14 of 33", "Weight": 1 }, { "Name": "Revenue 2009", "Score": 4, "ExtraInfo": "Value   23,250,000,000.00 ranks 9 of 19", "Weight": 1 }, { "Name": "Revenue 2008", "Score": 0, "ExtraInfo": "", "Weight": 1 }, { "Name": "Revenue 2008", "Score": 2, "ExtraInfo": "Value   22,484,000,000.00 ranks 9 of 30", "Weight": 1 }] }, "Profitability 1": { "OverallGroupRating": 2.88888888888888888888888888888888888889, "Components": [{ "Name": "Return on Sales 2014", "Score": 3, "ExtraInfo": "Value                 .10 ranks 14 of 30", "Weight": 1 }, { "Name": "Return on Sales 2013", "Score": 3, "ExtraInfo": "Value                 .08 ranks 25 of 59", "Weight": 1 }, { "Name": "Return on Sales 2012", "Score": 2, "ExtraInfo": "Value                 .13 ranks 21 of 63", "Weight": 1 }, { "Name": "Return on Sales 2011", "Score": 2, "ExtraInfo": "Value                 .10 ranks 19 of 52", "Weight": 1 }, { "Name": "Return on Sales 2010", "Score": 3, "ExtraInfo": "Value                 .11 ranks 15 of 33", "Weight": 1 }, { "Name": "Return on Sales 2009", "Score": 4, "ExtraInfo": "Value                 .13 ranks 11 of 19", "Weight": 1 }, { "Name": "Return on Sales 2008", "Score": 0, "ExtraInfo": "", "Weight": 1 }, { "Name": "Return on Assets 2014", "Score": 3, "ExtraInfo": "Value                 .13 ranks 7 of 30", "Weight": 1 }, { "Name": "Return on Assets 2013", "Score": 4, "ExtraInfo": "Value                 .11 ranks 17 of 59", "Weight": 1 }, { "Name": "Return on Assets 2012", "Score": 3, "ExtraInfo": "Value                 .15 ranks 16 of 63", "Weight": 1 }, { "Name": "Return on Assets 2011", "Score": 3, "ExtraInfo": "Value                 .11 ranks 17 of 52", "Weight": 1 }, { "Name": "Return on Assets 2010", "Score": 4, "ExtraInfo": "Value                 .12 ranks 12 of 33", "Weight": 1 }, { "Name": "Return on Assets 2009", "Score": 4, "ExtraInfo": "Value                 .21 ranks 6 of 19", "Weight": 1 }, { "Name": "Return on Assets 2008", "Score": 0, "ExtraInfo": "", "Weight": 1 }, { "Name": "Return on Assets 2014", "Score": 3, "ExtraInfo": "Value                 .02 ranks 16 of 30", "Weight": 1 }, { "Name": "Return on Assets 2013", "Score": 4, "ExtraInfo": "Value                 .02 ranks 35 of 59", "Weight": 1 }, { "Name": "Return on Assets 2012", "Score": 3, "ExtraInfo": "Value                 .03 ranks 25 of 63", "Weight": 1 }, { "Name": "Return on Assets 2011", "Score": 3, "ExtraInfo": "Value                 .02 ranks 25 of 52", "Weight": 1 }, { "Name": "Return on Assets 2010", "Score": 4, "ExtraInfo": "Value                 .02 ranks 18 of 33", "Weight": 1 }, { "Name": "Return on Assets 2009", "Score": 4, "ExtraInfo": "Value                 .03 ranks 11 of 19", "Weight": 1 }, { "Name": "Return on Assets 2008", "Score": 0, "ExtraInfo": "", "Weight": 1 }] }, "Safety 1": { "OverallGroupRating": 3.88888888888888888888888888888888888889, "Components": [{ "Name": "Market Cap", "Score": 1, "ExtraInfo": "", "Weight": 1 }, { "Name": "Current Ratio 2013", "Score": 5, "ExtraInfo": "Value                1.13 ranks 54 of 59", "Weight": 1 }, { "Name": "Current Ratio 2012", "Score": 5, "ExtraInfo": "Value                1.21 ranks 53 of 63", "Weight": 1 }, { "Name": "Current Ratio 2011", "Score": 5, "ExtraInfo": "Value                1.18 ranks 43 of 52", "Weight": 1 }, { "Name": "Current Ratio 2010", "Score": 5, "ExtraInfo": "Value                1.25 ranks 27 of 33", "Weight": 1 }, { "Name": "Current Ratio 2009", "Score": 5, "ExtraInfo": "Value                1.15 ranks 19 of 19", "Weight": 1 }, { "Name": "Current Ratio 2008", "Score": 0, "ExtraInfo": "", "Weight": 1 }, { "Name": "Debit Ratio 2013", "Score": 3, "ExtraInfo": "Value                1.62 ranks 22 of 40", "Weight": 1 }, { "Name": "Debit Ratio 2012", "Score": 3, "ExtraInfo": "Value                1.52 ranks 20 of 37", "Weight": 1 }, { "Name": "Debit Ratio 2011", "Score": 4, "ExtraInfo": "Value                1.48 ranks 22 of 32", "Weight": 1 }, { "Name": "Debit Ratio 2010", "Score": 5, "ExtraInfo": "Value                1.39 ranks 22 of 28", "Weight": 1 }, { "Name": "Debit Ratio 2009", "Score": 5, "ExtraInfo": "Value                1.70 ranks 12 of 15", "Weight": 1 }, { "Name": "Debit Ratio 2008", "Score": 0, "ExtraInfo": "", "Weight": 1 }, { "Name": "Quick Ratio 2013", "Score": 5, "ExtraInfo": "Value                 .91 ranks 49 of 59", "Weight": 1 }, { "Name": "Quick Ratio 2012", "Score": 5, "ExtraInfo": "Value                 .93 ranks 48 of 63", "Weight": 1 }, { "Name": "Quick Ratio 2011", "Score": 5, "ExtraInfo": "Value                 .58 ranks 50 of 52", "Weight": 1 }, { "Name": "Quick Ratio 2010", "Score": 5, "ExtraInfo": "Value                 .59 ranks 33 of 33", "Weight": 1 }, { "Name": "Quick Ratio 2009", "Score": 5, "ExtraInfo": "Value                 .56 ranks 19 of 19", "Weight": 1 }, { "Name": "Quick Ratio 2008", "Score": 0, "ExtraInfo": "", "Weight": 1 }] } }, "IndustryID": 73, "IndustryName": "Computers", "TickerName": "INTERNATIONAL BUSINESS MACHINES CORP", "SSRating": 2.72727272727272727272727272727272727273, "SSRank": 3, "IndustryRating": 3.03446773442831637669599433272181341577 };

$.getJSON(url, function (resp) {
	d = resp;
})
	.done(function () {
		insertJsonInHtml();
	})

	.fail(function () {
		insertJsonInHtml();
	})

	.always(function () {
		//insertJsonInHtml();
	});

function lerpColor(c1, c2, val) {

	var R1 = hexToR(c1);
	var G1 = hexToG(c1);
	var B1 = hexToB(c1);

	var R2 = hexToR(c2);
	var G2 = hexToG(c2);
	var B2 = hexToB(c2);

	var R = (1 - val) * R1 + val * R2;
	var G = (1 - val) * G1 + val * G2;
	var B = (1 - val) * B1 + val * B2;

	var rgb = B | (G << 8) | (R << 16) | (1 << 24);

	return '#' + rgb.toString(16).substring(1, 7);
}


function hexToR(h) { return parseInt((cutHex(h)).substring(0, 2), 16) }
function hexToG(h) { return parseInt((cutHex(h)).substring(2, 4), 16) }
function hexToB(h) { return parseInt((cutHex(h)).substring(4, 6), 16) }
function cutHex(h) {
	if (typeof h != 'undefined') {
		return (h.charAt(0) == "#") ? h.substring(1, 7) : h
	} else {
		return "888888";
	}

}

function ratingToColor(rating) {

	p = (rating - 1) / 4;

	colorA = "#53bb6a";
	colorB = "#f1db24";
	colorC = "#ee3131";

	if (p <= 0.5)
		colorT = lerpColor(colorA, colorB, p * 2);
	else
		colorT = lerpColor(colorB, colorC, (p - 0.5) * 2);

	return colorT;
}

function insertJsonInHtml() {

	// Top Header

	$('#TickerName').html(d.TickerName);
	$('#RatingValue').html("(" + Math.round(d.SSRating * 100) / 100 + ")");

	if (d.SSRating < 1.5) {
		$('#RatingLegend').html("A - Buy now");
		$('#RatingLegend').addClass("rating_text_A");
		$('#RatingValue').addClass("rating_text_A");

	} else if (d.SSRating > 1.5 && d.SSRating < 2.5) {
		$('#RatingLegend').html("B - Monitor - Buy on weakness");
		$('#RatingLegend').addClass("rating_text_B");
		$('#RatingValue').addClass("rating_text_B");


	} else if (d.SSRating > 2.5 && d.SSRating < 3.5) {
		$('#RatingLegend').html("C - Hold");
		$('#RatingLegend').addClass("rating_text_C");
		$('#RatingValue').addClass("rating_text_C");


	} else if (d.SSRating > 3.5 && d.SSRating < 4.5) {
		$('#RatingLegend').html("D - Sell on strength");
		$('#RatingLegend').addClass("rating_text_D");
		$('#RatingValue').addClass("rating_text_D");


	} else if (d.SSRating > 4.5) {
		$('#RatingLegend').html("F - Sell now");
		$('#RatingLegend').addClass("rating_text_F");
		$('#RatingValue').addClass("rating_text_F");

	}

	$('#name').html(d.TickerName + " (" + Math.round(d.SSRating * 100) / 100 + ")");
	$('#companyMarker').css("left", (d.SSRating - 1) * 240);

	$('#siName').html(d.IndustryName + " (" + Math.round(d.IndustryRating * 100) / 100 + ")");
	$('#subIndustryMarker').css("left", (d.IndustryRating - 1) * 240);

	// Iterate through ratingDetailBar

	headings = ['News Sentiment', 'Trading Sentiment', 'ESG', 'Bonds', 'Options', 'Timing', 'Valuation', 'Growth', 'Earnings', 'Cash Flow', 'Revenue', 'Profitability', 'Safety'];
	headingsWithLinks = ['Earnings', 'Cash Flow', 'Revenue'];

	var i = 0;

	titleBlocks = $(".component > .container > h2");
	componentScores = $(".component span.companyMarker");
	companyBalloons = $(".component span.companyBalloon");
	componentTables = $(".component div.component_table");

	$.each(d.RatingsGroups, function (index, value) {
		var items = $('<span class = "col1"></span>')

		// This should be preferred, because it comes from the database, and not hard coded as above:
		//var headings = index;

		// Headings links to Companies details
		if (inIframe()) {
			var tickerSymbolFromParent = window.parent.$('#lastPicked').html()
			var heading = headingsWithLinks.includes(headings[i])
				//? $(`<a class = "col3" href = "/Company/Details/${tickerSymbolFromParent}?bookmark=${headings[i]}" target = "_top"> ${headings[i]} </a>`)
				? $(`<a class = "col3" href = "/Company/${headings[i].replace(' ','')}/${tickerSymbolFromParent}" target = "_top"> ${headings[i]} </a>`)
				: $('<span class = "col3">' + headings[i] + '</span>')
		}
		else {
			var heading = headingsWithLinks.includes(headings[i])
				? $(`<a class = "col3" href = "/Company/${headings[i].replace(' ', '')}/${d.TickerSymbol.toUpperCase()}" target = "_top" > ${headings[i]} </a>`)
				: $('<span class = "col3">' + headings[i] + '</span>')
        }
		

		var j = index;
		// Title blocks
		var titleBlock = titleBlocks.eq(i);
		titleBlock.html(headings[i]);

		// OverallGroupRatings
		var componentScore = componentScores.eq(i);
		componentScore.css("left", (d.RatingsGroups[j].OverallGroupRating - 1) * 240);

		// Company Balloon Text
		var companyBalloon = companyBalloons.eq(i);
		companyBalloon.html(" (" + Math.round(d.RatingsGroups[j].OverallGroupRating * 100) / 100 + ")");

		// Detailed Table
		var componentTable = componentTables.eq(i);

		// Inner iteration through individual components
		$.each(d.RatingsGroups[index].Components, function (index, value) {

			var letterRating;
			var hxColor;

			if (d.RatingsGroups[j].Components[index].Score < 1.5) {
				letterRating = "A";
				hxColor = "#2cc42c";
			}
			if (d.RatingsGroups[j].Components[index].Score > 1.5) {
				letterRating = "B";
				hxColor = "#a1d600";
			}
			if (d.RatingsGroups[j].Components[index].Score > 2.5) {
				letterRating = "C";
				hxColor = "#e8e834";
			}
			if (d.RatingsGroups[j].Components[index].Score > 3.5) {
				letterRating = "D";
				hxColor = "#e89313";
			}
			if (d.RatingsGroups[j].Components[index].Score > 4.5) {
				letterRating = "F";
				hxColor = "#d14836";
			}

			var bar = $('<span  class="item" data-tip="' + d.RatingsGroups[j].Components[index].Name + ' (' + letterRating + ')" ></span>');
			bar.css("background-color", hxColor);

			var row = $('<div class="component_row"></div>');
			var c1 = $('<div class="column1">' + d.RatingsGroups[j].Components[index].Name + '</div>');
			var c2 = $('<div class="column2">' + letterRating + '</div>');
			c2.css("background-color", hxColor);
			var c3 = $('<div class="column3">' + d.RatingsGroups[j].Components[index].ExtraInfo + '</div>');
			row.append(c1);
			row.append(c2);
			row.append(c3);

			// Limit components 
			if (index > 10) return false;

			if (d.RatingsGroups[j].Components[index].Score > 0.5) {
				items.append(bar);
				componentTable.append(row);
			}

		})



		$('#rrsHeading').addClass("rrsHeading").append(heading);
		$('#rrsSegments').addClass("rrsSegments").append(items);
		if (inIframe()) {
			$(window.parent.parent.document.getElementById("rrsHeading")).addClass("rrsHeading").append(heading);
			$(window.parent.parent.document.getElementById("rrsSegments")).addClass("rrsSegments").append(items);
				
		}


		i++;
	});

	$('#ranksInIndustry').html("Ranks " + d.SSRank + " in " + d.IndustryName + " Industry");
	console.log("Ranks " + d.SSRank + " in " + d.IndustryName + " Industry");
}

function inIframe() {
	try {
		return window.self !== window.top;
	} catch (e) {
		return true;
	}
}
